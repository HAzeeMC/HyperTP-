name: PR Validation

on:
  pull_request:
    branches: [ main, master ]

jobs:
  validate:
    name: Validate Pull Request
    runs-on: ubuntu-latest

    steps:
    - name: Checkout PR
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: 'maven'

    - name: Build validation
      run: |
        echo "ðŸ—ï¸ Validating build..."
        mvn -B clean compile
        echo "âœ… Build validation passed"

    - name: Test validation
      run: |
        echo "ðŸ§ª Running tests..."
        mvn -B test
        echo "âœ… Test validation passed"

    - name: Package validation
      run: |
        echo "ðŸ“¦ Validating packaging..."
        mvn -B package -DskipTests
        
        JAR_FILE=$(find target -name "HyperTP-*.jar")
        if [ -z "$JAR_FILE" ]; then
          echo "âŒ Packaging failed: No JAR created"
          exit 1
        fi
        echo "âœ… Packaging validation passed"

    - name: PR Validation Summary
      run: |
        echo "âœ… PR Validation Summary" >> $GITHUB_STEP_SUMMARY
        echo "=======================" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Build**: âœ… Passed" >> $GITHUB_STEP_SUMMARY
        echo "**Tests**: âœ… Passed" >> $GITHUB_STEP_SUMMARY
        echo "**Packaging**: âœ… Passed" >> $GITHUB_STEP_SUMMARY
        echo "**Java Compatibility**: âœ… JDK 21" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "This pull request is ready for review! ðŸš€" >> $GITHUB_STEP_SUMMARY
