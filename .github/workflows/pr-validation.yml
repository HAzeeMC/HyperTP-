name: PR Validation

on:
  pull_request:
    branches: [ main, master ]

jobs:
  validate:
    name: Validate Pull Request
    runs-on: ubuntu-latest

    steps:
    - name: Checkout PR
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: 'maven'

    - name: Build validation
      run: |
        echo "🏗️ Validating build..."
        mvn -B clean compile
        echo "✅ Build validation passed"

    - name: Test validation
      run: |
        echo "🧪 Running tests..."
        mvn -B test
        echo "✅ Test validation passed"

    - name: Package validation
      run: |
        echo "📦 Validating packaging..."
        mvn -B package -DskipTests
        
        JAR_FILE=$(find target -name "HyperTP-*.jar")
        if [ -z "$JAR_FILE" ]; then
          echo "❌ Packaging failed: No JAR created"
          exit 1
        fi
        echo "✅ Packaging validation passed"

    - name: PR Validation Summary
      run: |
        echo "✅ PR Validation Summary" >> $GITHUB_STEP_SUMMARY
        echo "=======================" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Build**: ✅ Passed" >> $GITHUB_STEP_SUMMARY
        echo "**Tests**: ✅ Passed" >> $GITHUB_STEP_SUMMARY
        echo "**Packaging**: ✅ Passed" >> $GITHUB_STEP_SUMMARY
        echo "**Java Compatibility**: ✅ JDK 21" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "This pull request is ready for review! 🚀" >> $GITHUB_STEP_SUMMARY
